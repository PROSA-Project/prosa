--- Makefile.coq.orig	2021-10-04 11:15:22.592822933 +0200
+++ Makefile.coq	2021-10-04 11:17:18.684584261 +0200
@@ -15,6 +15,11 @@
 SELF := $(lastword $(MAKEFILE_LIST))
 PARENT := $(firstword $(MAKEFILE_LIST))
 
+# In the esy container, $HOME is hidden, but this causes Coq to complain.
+# We thus include a dummy $HOME value.
+HOME ?= $(DESTDIR)
+export HOME
+
 # This file is generated by coq_makefile and contains many variable
 # definitions, like the list of .v files or the path to Coq
 include Makefile.conf
@@ -211,7 +216,7 @@
 # these flags do NOT contain the libraries, to make them easier to overwrite
 COQFLAGS?=-q $(OTHERFLAGS) $(COQEXTRAFLAGS)
 COQCHKFLAGS?=-silent -o $(COQCHKEXTRAFLAGS)
-COQDOCFLAGS?=-interpolate -utf8 $(COQDOCEXTRAFLAGS)
+COQDOCFLAGS?=-interpolate -utf8 --parse-comments --external https://math-comp.github.io/htmldoc/ mathcomp $(COQDOCEXTRAFLAGS)
 
 COQDOCLIBS?=$(COQLIBS_NOML)
 
@@ -480,6 +485,9 @@
 	$(HIDE)mkdir -p html
 	$(HIDE)$(COQDOC) \
 		-toc $(COQDOCFLAGS) -html $(GAL) $(COQDOCLIBS) -d html $(VFILES)
+# Prosa hack: let's tweak the style a bit
+	$(HIDE)sed -i.bak "s/#90bdff/#eeeeee/" html/coqdoc.css
+	$(HIDE)rm html/coqdoc.css.bak
 
 mlihtml: $(MLIFILES:.mli=.cmi)
 	$(SHOW)'CAMLDOC -d $@'
@@ -504,6 +512,10 @@
 		-toc $(COQDOCFLAGS) -pdf $(GAL) $(COQDOCLIBS) \
 		-o $@ `$(COQDEP) -sort -suffix .v $(VFILES)`
 
+# Prosa: include pretty documentation targets
+include scripts/coqdocjs/Makefile.coqdocjs
+include scripts/Makefile.alectryon
+
 # FIXME: not quite right, since the output name is different
 gallinahtml: GAL=-g
 gallinahtml: html
